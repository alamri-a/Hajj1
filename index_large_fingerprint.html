<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<title>قياس زمن إنهاء إجراءات الحاج</title>
<style>
    body {
      font-family: Arial;
      text-align: center;
      margin: 30px;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid black;
    }
    th, td {
      padding: 8px;
    }
    .timer {
      font-size: 30px;
      margin: 20px;
    }
    .big-button {
      font-size: 40px;
      padding: 20px 40px;
      margin: 10px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    .start-button {
      background-color: green;
      color: white;
    }
    .stop-button {
      background-color: red;
      color: white;
    }
  </style>
</head>
<body>
<h2>قياس زمن إنهاء إجراءات الحاج</h2>
<button class="big-button start-button" onclick="startTimer()">▶ بدء</button>
<button class="big-button stop-button" onclick="stopTimer()">■ إنهاء</button>
<div class="timer" id="timer">00:00</div>
<div style="font-size: 22px; margin-top: 20px;">
<label>هل الحاج مسجل له بصمة سابقًا؟</label>
<input checked="" id="yes" name="fingerprint" style="transform: scale(1.5); margin: 0 10px;" type="radio" value="نعم"/>  نعم
  <input id="no" name="fingerprint" style="transform: scale(1.5); margin: 0 10px;" type="radio" value="لا"/>  لا
</div>
<div>
<input id="delayReason" placeholder="سبب التأخير (إن وجد)" style="width: 50%; font-size: 20px; padding: 10px;" type="text"/>
</div>
<h2 style="text-align: right; margin-top: 40px;">
      سجل الحجاج
      <button onclick="saveTableAsPDF()" style="font-size: 16px; padding: 5px 10px; margin-right: 10px; vertical-align: middle;">
        💾 حفظ PDF
      </button>
</h2>
<table id="logTable">
<thead>
<tr>
<th>التعداد</th>
<th>التاريخ</th>
<th>الساعة</th>
<th>المدة بالثواني</th>
<th>هل له بصمة؟</th>
<th>سبب التأخير</th>
</tr>
</thead>
<tbody></tbody>
</table>
<script>
let startTime;
let timerInterval;
let count = 1;

function startTimer() {
  const now = new Date();
  startTime = now;
  document.getElementById("timer").textContent = "00:00";

  timerInterval = setInterval(() => {
    const secondsPassed = Math.floor((new Date() - startTime) / 1000);
    document.getElementById("timer").textContent = `00:${secondsPassed < 10 ? '0' : ''}${secondsPassed}`;
  }, 1000);
}

function stopTimer() {
  clearInterval(timerInterval);

  const now = new Date();
  const durationInSeconds = Math.floor((now - startTime) / 1000);

  const date = now.toLocaleDateString('ar-EG');
  const time = now.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });

  const fingerprint = document.querySelector('input[name="fingerprint"]:checked').value;
  const delayReason = document.getElementById("delayReason").value;

  const table = document.getElementById("logTable").querySelector("tbody");
  const newRow = table.insertRow();
  newRow.innerHTML = `
    <td>${count++}</td>
    <td>${date}</td>
    <td>${time}</td>
    <td>${durationInSeconds}</td>
    <td>${fingerprint}</td>
    <td>${delayReason}</td>
  `;

  document.getElementById("timer").textContent = "00:00";
  document.getElementById("delayReason").value = "";
}
</script>
</body>
</html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
function saveTableAsPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  html2canvas(document.querySelector("#logTable")).then(canvas => {
    const imgData = canvas.toDataURL("image/png");
    const imgProps = doc.getImageProperties(imgData);
    const pdfWidth = doc.internal.pageSize.getWidth();
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

    doc.addImage(imgData, 'PNG', 10, 10, pdfWidth - 20, pdfHeight);
    doc.save("سجل_الحجاج.pdf");
  });
}
</script>
